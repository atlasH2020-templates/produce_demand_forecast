{
  "openapi": "3.0.3",
  "info": {
    "title": "Experimental produce_demand_forecaster Service Template",
    "version": "0.0.1",
    "description": "Template for services that provides demand forecasting data for
    producers and merchants on the short supply chain."
  },
  "tags": [
    {
      "name": "Forecast"
    },
    {
      "name": "Time-series"
    }
  ],
  "paths": {
    "/geo": {
      "get": {
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "tags": [
          "Parameters"
        ],
        "summary": "Gets the supported GEO codes for which demand forecast data
        is available",
        "description": "Retrieves an object, the keys of which are the supported GEO
        codes. The values are objects with metadata that describe the geographic
        object.",
        "responses": {
          "200": {
            "description": "Success",
            "content": {
              "application/json": {
                "schema": {
                  "description": "The suported geo codes and their metadata.",
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "code": {
                        "description": "The abbreviation code for the location for
                        which to yield the demand forecast.",
                        "type": "string"
                      },
                      "country": {
                        "description": "Country of the location.",
                        "type": "string"
                      },
                      "city": {
                        "description": "Name of the city of the location.",
                        "type": "string"
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Invalid or missing credentials",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "description": "A generic error message, given when an unexpected condition was encountered and no more specific message is suitable.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/forecast": {
      "get": {
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "tags": [
          "Capabilities"
        ],
        "parameters": [
          {
            "name": "geo",
            "in": "path",
            "type": "string",
            "required": "true",
            "description": "the geographic id of the city a demand forecast is queried"
          },
          {
            "name": "from",
            "in": "query",
            "type": "string",
            "required": "true",
            "description": "the from date, first day of the forecasting window."
          },
          {
            "name": "until",
            "in": "query",
            "type": "string",
            "required": "true"
          },
          {
            "name": "product",
            "in": "query",
            "type": "string",
            "required": "true"
          }
        ],
        "summary": "Forecast",
        "description": "Retrieves the list of parameters supported by the implementor of this service. Request for parameters outside of the response list will never produce data.",
        "requestBody": {
          "description": "",
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "description": "Request body format for the data query.",
                "type": "object",
                "required": [
                  "from",
                  "to",
                ],
                "properties": {
                  "from": {
                    "$ref": "#/components/schemas/Timestamp"
                  },
                  "to": {
                    "$ref": "#/components/schemas/Timestamp"
                  }
                }
              }
            }
          }
        },

        "responses": {
          "200": {
            "description": "Success",
            "content": {
              "application/json": {
                "schema": {
                  "description": "",
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/ParameterTypes"
                  },
                  "example": [
                    "ATMO__T",
                    "SOIL__T",
                    "ATMO__RAINFLOW",
                    "ATMO__RAINFALL"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "Invalid or missing credentials",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "500": {
            "description": "A generic error message, given when an unexpected condition was encountered and no more specific message is suitable.",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    },
    "schemas": {
      "Parameters": {
        "description": "Aggregated time series for a parameter at a given location, contained in a 'data' branch of a response.",
        "type": "object",
        "minProperties": 1,
        "properties": {
          "min": {
            "$ref": "#/components/schemas/DataSeriesType"
          },
          "max": {
            "$ref": "#/components/schemas/DataSeriesType"
          },
          "avg": {
            "$ref": "#/components/schemas/DataSeriesType"
          },
          "sum": {
            "$ref": "#/components/schemas/DataSeriesType"
          }
        }
      },
      "Timestamp": {
        "type": "string",
        "format": "date-time",
        "description": "ISO8601 encoded date time - inclusive as left bound and exclusive as right bound.",
        "example": "2021-09-28T01:00:00.000Z"
      },
      "Error": {
        "description": "This defines the structure of an error payload when one is present. Actual messages and additional error information content may change from one implementation to another",
        "type": "object",
        "required": [
          "message"
        ],
        "properties": {
          "message": {
            "type": "string",
            "description": "Error description.",
            "example": "General description"
          },
          "errors": {
            "description": "Additional detailed information",
            "type": "array",
            "items": {
              "type": "string"
            },
            "example": [
              "optional",
              "additional",
              "details"
            ]
          }
        }
      }
    }
  }
}
